# Dev
`npm run pg-clear` - remove `./data` folder and run `docker-compose rm -f`
 
`npm run pg-start` - start PostgreSQL in docker container on `localhost:5432` and pgAdmin 4 on `localhost:5050`
 
`npm run pg-stop` - stop PostgreSQL and pgAdmin 4 docker containers

# Project start

- `git clone ...`
- `cd project_dir`
- rename `.env_example` to `.env` file and edit it
- rename `./config/config_example.js` to `./config/config.js` file and edit it
- `docker-compose build`
- `docker-compose up -d`

# Generate api key for service

To add service you need to generate api key (any string) and put this key to `./config/config.js` to `allowed_services` section, example:

- Generate random string:
```
$ node -e 'console.log(require("crypto").randomBytes(16).toString("hex"))'
7da38f8a054ce8f97ea063e4007218b8
```
- Edit `config.js`:
```
...
allowed_services: [
        {
            platform: "My new platform",
            secret: "7da38f8a054ce8f97ea063e4007218b8"
        }
    ]
...
```
- Restart Identity Platform
```
$ docker-compose restart
```
 
# GraphQL requests requirements
Every request should contain in headers `secret` object, example:
```json
{
  "secret":"7da38f8a054ce8f97ea063e4007218b8"
}
```

# Other info

# File description:
**mineority_identity_database.dbm** - Database structure model for PgModeller app (download [here](https://pgmodeler.io/) or through `apt install pgmodeler` ) 

**tables.sql** - Autogenerated SQL code from `mineority_identity_database.dbm` 

**.env_example** - Dotenv example file, in production should be renamed to `.env`

**config/config_example.js** - Example of config, in production should be renamed to `config/config.js`

**model.xmi** - UML diagram for Umbrello (`apt install umbrello`)